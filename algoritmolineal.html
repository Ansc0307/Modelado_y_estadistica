<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador Congruencial Lineal</title>
  <link rel="stylesheet" href="css/algoritmolineal.css">
</head>
<body>
  <h2>Algoritmo Lineal</h2>
  
  <div class="inputs">
    <input type="number" id="x0" placeholder="X₀">
    <input type="number" id="k" placeholder="K">
    <input type="number" id="c" placeholder="c">
    <input type="number" id="p" placeholder="P">
    <input type="number" id="decimales" placeholder="Decimales">
  </div>
  
  <div style="text-align:center;">
    <button class="btn-gen" onclick="generar()">Generar</button>
    <button class="btn-clear" onclick="limpiar()">Limpiar</button>
  </div>
  
  <div id="params"></div>
  
  <table id="tabla" style="display:none;">
    <thead>
      <tr>
        <th>i</th>
        <th>X<sub>i-1</sub></th>
        <th>Operación</th>
        <th>X<sub>i</sub></th>
        <th>r<sub>i</sub></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function esEnteroPositivo(n) {
      return Number.isInteger(n) && n > 0;
    }

    function mcd(a, b) {
      while (b !== 0) {
        let temp = b;
        b = a % b;
        a = temp;
      }
      return a;
    }

    function generar() {
      const x0 = parseInt(document.getElementById("x0").value);
      const k = parseInt(document.getElementById("k").value);
      const c = parseInt(document.getElementById("c").value);
      const p = parseInt(document.getElementById("p").value);
      const decimales = parseInt(document.getElementById("decimales").value);

      // Validaciones
      if (!esEnteroPositivo(p)) {
        alert("P debe ser un número positivo y entero.");
        return;
      }
      if (!esEnteroPositivo(x0)) {
        alert("X₀ debe ser un número positivo y entero.");
        return;
      }
      if (!esEnteroPositivo(k)) {
        alert("K debe ser un número positivo y entero.");
        return;
      }
      if (!esEnteroPositivo(c)) {
        alert("c debe ser un número positivo y entero.");
        return;
      }
      if (decimales < 2) {
        alert("Se recomienda usar al menos 2 decimales.");
        return;
      }

      // g = log2(p) redondeado hacia arriba
      const g = Math.ceil(Math.log(p) / Math.log(2));
      const m = Math.pow(2, g);
      const a = 1 + 4 * k;

      if (mcd(c, m) !== 1) {
        alert("c debe ser relativamente primo con m = " + m);
        return;
      }

      document.getElementById("params").innerText = `a: ${a} ; c: ${c} ; g: ${g} ; m: ${m}`;

      let xi = x0;
      let tabla = document.querySelector("#tabla tbody");
      tabla.innerHTML = "";

      for (let i = 1; i <= p + 1; i++) {
        let operacion = `(${a} * ${xi} + ${c}) mod (${m})`;
        let xi_sig = (a * xi + c) % m;
        let ri = (xi_sig / (m - 1)).toFixed(decimales);

        let fila = `<tr>
                      <td>${i}</td>
                      <td>${xi}</td>
                      <td>${operacion}</td>
                      <td>${xi_sig}</td>
                      <td>${ri}</td>
                    </tr>`;
        tabla.innerHTML += fila;
        xi = xi_sig;
      }

      document.getElementById("tabla").style.display = "table";
    }

    function limpiar() {
      document.querySelectorAll("input").forEach(inp => inp.value = "");
      document.getElementById("params").innerText = "";
      document.querySelector("#tabla tbody").innerHTML = "";
      document.getElementById("tabla").style.display = "none";
    }
  </script>
</body>
</html>
